@using Microsoft.AspNetCore.Components
@inject IJSRuntime JSRuntime

<div id="connection-status" class="connection-status @(isConnected ? "connected" : "disconnected")" style="display: none;">
    <div class="connection-indicator">
        <i class="bi @(isConnected ? "bi-wifi" : "bi-wifi-off")"></i>
        <span>@(isConnected ? "ConnectÃ©" : "DÃ©connectÃ©")</span>
    </div>
</div>

@code {
    private bool isConnected = true;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("eval", @"
                // Ã‰couter les Ã©vÃ©nements de connexion Blazor
                window.addEventListener('beforeunload', function() {
                    // Page en cours de fermeture
                });

                // GÃ©rer les erreurs de connexion
                if (window.Blazor) {
                    window.Blazor.defaultReconnectionHandler = {
                        onConnectionDown: function() {
                            console.log('ðŸ”´ Connexion Blazor perdue');
                            document.getElementById('connection-status').style.display = 'block';
                            document.getElementById('connection-status').classList.remove('connected');
                            document.getElementById('connection-status').classList.add('disconnected');
                        },
                        onConnectionUp: function() {
                            console.log('ðŸŸ¢ Connexion Blazor rÃ©tablie');
                            document.getElementById('connection-status').style.display = 'none';
                        },
                        onReconnectionAttempt: function() {
                            console.log('ðŸ”„ Tentative de reconnexion...');
                        }
                    };
                }
            ");
        }
    }
}
