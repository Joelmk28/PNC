@page "/camera-quick-test"
@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime

<PageTitle>Test Rapide Cam√©ra - PNC</PageTitle>

<div class="camera-quick-test">
    <div class="container">
        <h1>üìπ Test Rapide de la Cam√©ra</h1>
        <p>Page de test simple pour v√©rifier que la cam√©ra fonctionne imm√©diatement</p>
        
        <div class="test-section">
            <h3>üé• Test Imm√©diat</h3>
            <button class="btn btn-primary" @onclick="TestCameraImmediately">
                <i class="bi bi-camera"></i> Tester la Cam√©ra Maintenant
            </button>
            
            <div class="camera-display">
                <video id="quickTestVideo" autoplay playsinline style="width: 100%; max-width: 400px; border: 2px solid #ddd; background-color: #000; margin-top: 20px;"></video>
            </div>
            
            <div class="status-info">
                <p><strong>Statut:</strong> <span id="cameraStatus">En attente...</span></p>
                <p><strong>Erreur:</strong> <span id="cameraError">Aucune</span></p>
            </div>
        </div>
        
        <div class="debug-section">
            <h3>üîç Informations de D√©bogage</h3>
            <button class="btn btn-secondary" @onclick="CheckJavaScriptFunctions">
                <i class="bi bi-code"></i> V√©rifier les Fonctions JavaScript
            </button>
            
            <div class="debug-info" id="debugInfo">
                <p>Cliquez sur le bouton pour v√©rifier les fonctions disponibles</p>
            </div>
        </div>
    </div>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // V√©rifier imm√©diatement les fonctions JavaScript
            await CheckJavaScriptFunctions();
        }
    }

    private async Task TestCameraImmediately()
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("updateStatus", "cameraStatus", "Test en cours...");
            await JSRuntime.InvokeVoidAsync("updateStatus", "cameraError", "Aucune");
            
            // Test simple de la cam√©ra
            var success = await JSRuntime.InvokeAsync<bool>("testCameraSimple");
            
            if (success)
            {
                await JSRuntime.InvokeVoidAsync("updateStatus", "cameraStatus", "‚úÖ Cam√©ra fonctionne");
            }
            else
            {
                await JSRuntime.InvokeVoidAsync("updateStatus", "cameraStatus", "‚ùå Cam√©ra ne fonctionne pas");
            }
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("updateStatus", "cameraStatus", "‚ùå Erreur");
            await JSRuntime.InvokeVoidAsync("updateStatus", "cameraError", ex.Message);
        }
    }

    private async Task CheckJavaScriptFunctions()
    {
        try
        {
            var debugInfo = await JSRuntime.InvokeAsync<string>("getDebugInfo");
            await JSRuntime.InvokeVoidAsync("updateDebugInfo", debugInfo);
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("updateDebugInfo", $"Erreur: {ex.Message}");
        }
    }
}
